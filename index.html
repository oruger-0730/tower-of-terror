<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚¿ãƒ¯ãƒ¼ãƒ»ã‚ªãƒ–ãƒ»ãƒ†ãƒ©ãƒ¼ ç®¡ç†å®¤</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: linear-gradient(to bottom, #0f172a, #1e293b);
      color: #f1f5f9;
    }
    header, footer {
      padding: 10px 20px;
      background: #0f172a;
    }
    h1 { margin: 0; }
    .elevator-section {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      padding: 16px;
      max-width: 1700px;
      margin: auto;
    }
    .elevator-panel {
      background: #1e293b;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }
    .camera-layout {
      display: flex;
      gap: 6px;
      justify-content: center;
      margin-bottom: 8px;
    }
    .shaft {
      background: #0008;
      width: 90px;
      height: 300px;
      border-radius: 6px;
      position: relative;
      overflow: hidden;
    }
    .car {
      position: absolute;
      width: 90px;
      height: 45px;
      background: #4b5563;
      border-radius: 6px;
      bottom: 0;
      transition: bottom 2s linear;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-size: 14px;
    }
    .doors {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      display: flex;
      pointer-events: none;
    }
    .door {
      width: 50%;
      background: #1f2937;
      transition: transform 1.5s ease;
    }
    .door.open-left {
      transform: translateX(-100%);
    }
    .door.open-right {
      transform: translateX(100%);
    }
    button {
      cursor: pointer;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      margin: 2px;
      color: #fff;
    }
    .green { background: #059669; }
    .amber { background: #d97706; }
    .red { background: #b91c1c; }
    .blue { background: #2563eb; }
    .gray { background: #475569; }
    .floor-buttons {
      display: grid;
      grid-template-columns: repeat(4,1fr);
      gap: 6px;
    }
    .log {
      font-family: monospace;
      font-size: 12px;
      max-height: 120px;
      overflow-y: auto;
      background: #0f172a;
      padding: 6px;
    }
  </style>
</head>
<body>
<header>
  <h1>ã‚¿ãƒ¯ãƒ¼åˆ¶å¾¡ â€” 3ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ç®¡ç†</h1>
  <small id="time"></small>
</header>

<div class="elevator-section" id="system"></div>

<footer>
  ãƒ‡ãƒ¢UI Â· å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã«ç½®ãæ›ãˆã¦ä½¿ç”¨ã—ã¦ãã ã•ã„
</footer>

<script>
const MAX_FLOOR = 20;
const elevators = {
  A: createElevator("A"),
  B: createElevator("B"),
  C: createElevator("C"),
};

function createElevator(id) {
  return {
    id,
    floor: 1,
    targetFloor: null,
    doors: "closed",
    moving: false,
    speed: 0,
    lockedOut: false,
    emergency: false,
    log: [],
  };
}

function pushLog(el, msg) {
  el.log.unshift(new Date().toLocaleTimeString() + " â€” " + msg);
  if (el.log.length > 40) el.log.pop();
}

function render() {
  document.getElementById("time").textContent = new Date().toLocaleString();
  const sys = document.getElementById("system");
  sys.innerHTML = "";
  Object.values(elevators).forEach(el => {
    const div = document.createElement("div");
    div.className = "elevator-panel";
    const percent = (el.floor - 1) / (MAX_FLOOR - 1) * 100;
    div.innerHTML = `
      <h2>ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ ${el.id}</h2>

      <div class="camera-layout">
        <div class="shaft">
          <div class="car" id="car-${el.id}" style="bottom:${percent}%;">${el.floor}F</div>
          <div class="doors">
            <div class="door ${(el.doors==="open") ? "open-left" : ""}"></div>
            <div class="door ${(el.doors==="open") ? "open-right" : ""}"></div>
          </div>
        </div>
      </div>

      <p><b>ç¾åœ¨éš:</b> ${el.floor} / <b>ç›®æ¨™:</b> ${el.targetFloor ?? "â€”"}</p>
      <p><b>çŠ¶æ…‹:</b> ${el.emergency ? "ğŸš¨éå¸¸" : el.lockedOut ? "ğŸ”’ãƒ­ãƒƒã‚¯" : el.moving ? "ç§»å‹•ä¸­" : "åœæ­¢"}</p>
      
      <div class="floor-buttons">
        ${Array.from({length:MAX_FLOOR},(_,i)=>MAX_FLOOR-i).map(f=>`<button class="gray" onclick="move('${el.id}',${f})">${f}</button>`).join("")}
      </div>
      <br>
      <button class="green" onclick="doors('${el.id}',true)">é–‹</button>
      <button class="amber" onclick="doors('${el.id}',false)">é–‰</button>
      <button class="gray" onclick="toggleLock('${el.id}')">ãƒ­ãƒƒã‚¯åˆ‡æ›¿</button>
      <button class="red" onclick="emergency('${el.id}')">éå¸¸åœæ­¢</button>
      <button class="blue" onclick="clearEmergency('${el.id}')">éå¸¸è§£é™¤</button>
      <br><br>
      <button class="blue" onclick="move('${el.id}',1)">ãƒ­ãƒ“ãƒ¼ã¸</button>
      <button class="blue" onclick="move('${el.id}',${MAX_FLOOR})">æœ€ä¸Šéšã¸</button>
      <button class="amber" onclick="stop('${el.id}')">åœæ­¢</button>

      <h4>ãƒ­ã‚°</h4>
      <div class="log">${el.log.map(l=>`<div>${l}</div>`).join("")}</div>
    `;
    sys.appendChild(div);
  });
}

function move(id,f) {
  const el = elevators[id];
  if (el.lockedOut || el.emergency) return pushLog(el,"æ“ä½œãƒ–ãƒ­ãƒƒã‚¯");
  el.targetFloor = f;
  doors(id,false);
  pushLog(el,`æŒ‡ä»¤: ${f}éšã¸ç§»å‹•`);
}

function stop(id) {
  const el = elevators[id];
  el.targetFloor = null;
  el.moving = false;
  pushLog(el,"æ‰‹å‹•åœæ­¢");
}

function doors(id,open) {
  const el = elevators[id];
  el.doors = open ? "open" : "closed";
  pushLog(el, open ? "ãƒ‰ã‚¢é–‹" : "ãƒ‰ã‚¢é–‰");
}

function toggleLock(id){
  const el = elevators[id];
  el.lockedOut = !el.lockedOut;
  pushLog(el, el.lockedOut ? "ãƒ­ãƒƒã‚¯æœ‰åŠ¹" : "ãƒ­ãƒƒã‚¯è§£é™¤");
}

function emergency(id){
  const el = elevators[id];
  el.emergency = true;
  el.moving = false;
  el.speed = 0;
  pushLog(el,"âš  éå¸¸åœæ­¢");
}

function clearEmergency(id){
  const el = elevators[id];
  el.emergency = false;
  pushLog(el,"éå¸¸è§£é™¤");
}

setInterval(()=>{
  Object.values(elevators).forEach(el=>{
    if (el.emergency || el.lockedOut) return;
    if (el.targetFloor && el.targetFloor !== el.floor) {
      el.moving = true;
      el.speed = 1;
      el.floor += (el.targetFloor > el.floor ? 1 : -1);
      pushLog(el, `${el.floor}éšé€šé`);
      if (el.floor === el.targetFloor) {
        el.moving = false;
        el.speed = 0;
        doors(el.id,true);
        pushLog(el, `${el.floor}éšã«åˆ°ç€`);
        el.targetFloor = null;
      }
    }
  });
  render();
},2000); // <-- ç§»å‹•ã‚’ 2ç§’/éš ã«é…å»¶

render();
</script>
</body>
</html>
